<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<style>
pre    { color: black; background-color: #F6F6F6; }
code   { color: black; }
.input { color: blue; }
</style>
</head>
<div style="width: 600px">
<h2>Debugging</h2>
This is a simple <b>tutorial</b> using the top-level processing Qt events:
<pre>
  $ <span class="input">eql -qtpl</span>
</pre>
<br>
<h3>Example 1: Error on REPL (trivial)</h3>
<pre>

  EQL-USER[1]> <span class="input">(/ 0 0)</span>

  Condition of type: DIVISION-BY-ZERO

  Available restarts:

  1. (RESTART-TOPLEVEL) Go back to Top-Level REPL.
  2. (RESTART-QT-EVENTS) Restart Qt event processing.

  ** BREAK [LEVEL 2]>

</pre>
&nbsp;&nbsp;&nbsp;<img src="debug-dialog.png"/>
<p>Note that all debug input is handled in a debug dialog, <b>not</b> in the
console window.</p>
<p>So, either type the restart number in the dialog
<pre><span class="input"> :r1</span></pre>
or just click the Cancel button, which will always choose <code>:r1</code>.
<br>Type <code>:h</code> for all available debug options.
<p>Both restarts will have the same effect here, see note at bottom.</p>
<br>&nbsp;
<h3>Example 2: Error during Qt event processing</h3>
Start calculator example:
<pre>
  $ <span class="input">eql -qtpl examples/X-extras/calculator</span>
</pre>
<br>
Let's run this function:
<pre>
  EQL-USER[1]> <span class="input">(clc:auto "42 ? blah")</span>
</pre>
<br>
This will output 2 errors, without breaking into the debugger:
<pre>

  [EQL:err] QFIND-CHILD #&lt;QDialog "" 0x39737d0 [1]&gt; "?"

  [EQL:err] QINVOKE-METHOD NIL NIL "animateClick" (400)

</pre>
<p><b>Note</b>: After eventual print output (like the above), you
  won't see a fresh top-level prompt.<br>Don't get confused by this, as
  you can continue to enter commands.</p>
<br>
Now make EQL errors break into the debugger:
<pre>
  EQL-USER[2]> <span class="input">(setf eql:*break-on-errors* t)</span>
</pre>
<br>
Run our function again:
<pre>

  EQL-USER[3]> <span class="input">(clc:auto "42 ? blah")</span>

  Condition of type: SIMPLE-CONDITION

  [EQL:err] QFIND-CHILD #&lt;QDialog "" 0x39737d0 [1]&gt; "?"

  Available restarts:

  1. (CONTINUE) Return from BREAK.
  2. (RESTART-QT-EVENTS) Restart Qt event processing.

  ** BREAK [LEVEL 1]>

</pre>
&nbsp;&nbsp;&nbsp;<img src="debug-dialog.png"/>
<p>Now there are 2 possible restarts:</p>
<pre><span class="input"> :r1</span></pre>
<code>(CONTINUE)</code> will continue execution, which will break on
the next error, then finish our function.
<pre><span class="input"> :r2</span></pre>
<code>(RESTART-QT-EVENTS)</code> will abort execution, returning to
the REPL immediately.
<br><br>
<hr>
<br><br>
<h3>Notes</h3>
There is one situation where interactive debugging won't work, and
this is in code inside an (overridden)
<pre>"paintEvent(QPaintEvent*)"</pre> function, as this may cause
recursive paint events and segfaults.
<br>&nbsp;
<br>&nbsp;<br>
On simple <code>read</code> errors on the REPL (e.g. non-existing packages, non-external symbols), the debugger will not be entered (as this would cause an unrecoverable <code>break</code>, since <code>read</code> runs in its own thread here); instead, the erroneous input string will be returned as-is.
<br>&nbsp;
<br>&nbsp;<br>
The conflicting case
<pre> (RESTART-TOPLEVEL)
 (RESTART-QT-EVENTS)</pre>
is resolved automatically (<code>RESTART-QT-EVENTS</code> would block the REPL in this case).
<br>&nbsp;
<br>&nbsp;
</div>
</html>
