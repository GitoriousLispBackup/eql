<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
</head>
<h2>Slime OSX and Unix</h2>
<ul>
<li>Patch your <code>slime/swank-ecl.lisp</code>,  adding the marked code (see <code>patches/unix/swank-ecl.lisp.snip</code>).
<pre>
;;; Instead of busy waiting with communication-style NIL, use select()
;;; on the sockets' streams.
#+serve-event
<span class="added">(let ((embedded-qt-lisp (find :eql *features*))) ; [EQL]</span>
  (defun poll-streams (streams timeout)
    (let* ((serve-event::*descriptor-handlers*
            (copy-list serve-event::*descriptor-handlers*))
           (active-fds '())
           (fd-stream-alist
            (loop for s in streams
                  for fd = (socket-fd s)
                  collect (cons fd s)
                  do (serve-event:add-fd-handler fd :input
                                                 #'(lambda (fd)
                                                     (push fd active-fds))))))
      (serve-event:serve-event timeout)
      (loop for fd in active-fds collect (cdr (assoc fd fd-stream-alist)))))

  (defimplementation wait-for-input (streams &optional timeout)
    (assert (member timeout '(nil t)))
    (loop
      (cond ((check-slime-interrupts) (return :interrupt))
            (timeout (return (poll-streams streams 0)))
            (t
             <span class="added">;; [EQL]
             (when embedded-qt-lisp
               (eql:qexec 200))</span>
             (when-let (ready (poll-streams streams <span class="added">(if embedded-qt-lisp 0.02</span> 0.2<span class="added">)</span>))<span class="added"> ; [EQL]</span>
               (return ready))))))  

) ; #+serve-event (progn ...
</pre>
<li>In your <code>.emacs</code> file, point your Lisp implementation to the <code>eql</code> executable: 
<code>(setq inferior-lisp-program "/path-to-eql/eql")</code>
<li>For help in Slime mode, see the <code>qapropos</code> and <code>qgui</code> functions.
</ul>
Please make sure you have your Slime Lisp set to <code>EQL</code> (see above) when starting it for the first time (that is, when it is compiled), otherwise it will complain about a missing <code>eql:qprocess-events</code> symbol (after compilation of <code>swank-ecl.lisp</code>, you may switch between <code>EQL</code> and <code>ECL</code> at any time).
</html>
